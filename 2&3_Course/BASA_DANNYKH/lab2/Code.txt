CREATE DATABASE LabTwo;
USE LabTwo;
CREATE TABLE Buyer (
BuyerID INT UNSIGNED NOT NULL UNIQUE AUTO_INCREMENT,
PassportID INT UNSIGNED NOT NULL,
CONSTRAINT BuyerID PRIMARY KEY (BuyerID)
 );
DESCRIBE Buyer;
CREATE TABLE Trace (
TraceID INT UNSIGNED NOT NULL UNIQUE AUTO_INCREMENT,
Name VARCHAR(40) NOT NULL,
CONSTRAINT TraceID PRIMARY KEY (TraceID)
 );
DESCRIBE Trace;
CREATE TABLE Station (
StationID INT UNSIGNED NOT NULL UNIQUE AUTO_INCREMENT,
Name VARCHAR(40) NOT NULL,
CONSTRAINT StationID PRIMARY KEY (StationID)
 );
DESCRIBE Station;
CREATE TABLE Train (
TrainID INT UNSIGNED NOT NULL UNIQUE AUTO_INCREMENT,
TrainNumber INT UNSIGNED NOT NULL,
TraceID INT UNSIGNED NOT NULL,
CONSTRAINT TrainID PRIMARY KEY (TrainID),
CONSTRAINT TrainForeignTrace FOREIGN KEY (TraceID) REFERENCES Trace (TraceID) ON DELETE CASCADE ON UPDATE CASCADE
 );
DESCRIBE Train;
CREATE TABLE Vagon (
VagonID INT UNSIGNED NOT NULL UNIQUE AUTO_INCREMENT,
VagonNumber INT UNSIGNED NOT NULL,
VagonType VARCHAR(40) NOT NULL,
TrainID INT UNSIGNED NOT NULL,
CONSTRAINT VagonID PRIMARY KEY (VagonID),
CONSTRAINT VagonForeignTrain FOREIGN KEY (TrainID) REFERENCES Train (TrainID) ON DELETE CASCADE ON UPDATE CASCADE
 );
DESCRIBE Vagon;
CREATE TABLE Seat (
SeatID INT UNSIGNED NOT NULL UNIQUE AUTO_INCREMENT,
SeatNumber INT UNSIGNED NOT NULL,
VagonID INT UNSIGNED NOT NULL,
CONSTRAINT SeatID PRIMARY KEY (SeatID),
CONSTRAINT SeatForeignVagon FOREIGN KEY (VagonID) REFERENCES Vagon (VagonID) ON DELETE CASCADE ON UPDATE CASCADE
 );
DESCRIBE Seat;
CREATE TABLE Stop (
StopID INT UNSIGNED NOT NULL UNIQUE AUTO_INCREMENT,
StartTime DATETIME NOT NULL,
FinishTime DATETIME NOT NULL,
NumberInTrace INT UNSIGNED NOT NULL,
StationID INT UNSIGNED NOT NULL,
TraceID INT UNSIGNED NOT NULL,
CONSTRAINT StopID PRIMARY KEY (StopID),
CONSTRAINT StopForeignTrace FOREIGN KEY (TraceID) REFERENCES Trace (TraceID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT StopForeignStation FOREIGN KEY (StationID) REFERENCES Station (StationID) ON DELETE CASCADE ON UPDATE CASCADE
 );
DESCRIBE Stop;
CREATE TABLE Ticket (
TicketID INT UNSIGNED NOT NULL UNIQUE AUTO_INCREMENT,
Price FLOAT(7, 2) UNSIGNED NOT NULL,
BuyerID INT UNSIGNED NOT NULL,
SeatID INT UNSIGNED NOT NULL,
FirstStopID INT UNSIGNED NOT NULL,
LastStopID INT UNSIGNED NOT NULL,
CONSTRAINT TicketID PRIMARY KEY (TicketID),
CONSTRAINT TicketForeignBuyer FOREIGN KEY (BuyerID) REFERENCES Buyer (BuyerID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT TicketForeignSeat FOREIGN KEY (SeatID) REFERENCES Seat (SeatID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT TicketForeignFirstStop FOREIGN KEY (FirstStopID) REFERENCES Stop (StopID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT TicketForeignLastStop FOREIGN KEY (LastStopID) REFERENCES Stop (StopID) ON DELETE CASCADE ON UPDATE CASCADE
 );
DESCRIBE Ticket;
SHOW TABLES;
ALTER TABLE Trace MODIFY Name VARCHAR(50);
DESCRIBE Trace;
ALTER TABLE Trace ADD COLUMN DummyInformation VARCHAR(50);
DESCRIBE Trace;
ALTER TABLE Buyer ALTER COLUMN PassportID SET DEFAULT 1;
DESCRIBE Buyer;
ALTER TABLE Trace DROP COLUMN DummyInformation;
DESCRIBE Trace;
Create TABLE UNnessesary(ID INT);
SHOW TABLES;
DROP TABLE UNnessesary;
SHOW TABLES;
INSERT INTO Buyer (PassportID) VALUES (200);
DELETE FROM Buyer WHERE PassportID = 200;
ALTER TABLE Buyer ADD CONSTRAINT MaxPassportID CHECK (PassportID < 160);
ALTER TABLE Buyer DROP CONSTRAINT MaxPassportID;
INSERT INTO Buyer (PassportID) VALUES (200);
DELETE FROM Buyer WHERE PassportID = 200;
SELECT host, user FROM mysql.user;
CREATE USER 'Lupin'@'localhost' IDENTIFIED BY 'yyjCJ#AAaaaE214';
CREATE USER 'Gregor'@'localhost' IDENTIFIED BY 'PPafMMM0H$';
SELECT host, user FROM mysql.user;
SHOW GRANTS FOR 'Lupin'@'localhost';
SHOW GRANTS FOR 'Gregor'@'localhost';
GRANT SELECT ON LabTwo.Ticket TO 'Lupin'@'localhost';
GRANT ALL ON LabTwo TO 'Gregor'@'localhost';
SHOW GRANTS FOR 'Lupin'@'localhost';
SHOW GRANTS FOR 'Gregor'@'localhost';
CREATE ROLE 'spectator', 'redactor';
GRANT SELECT ON * TO 'spectator';
GRANT ALL ON * TO 'redactor';
GRANT 'spectator' TO 'Lupin'@'localhost';
GRANT 'redactor' TO 'Gregor'@'localhost';
SHOW GRANTS FOR 'Lupin'@'localhost' USING 'spectator';
SHOW GRANTS FOR 'Gregor'@'localhost' USING 'redactor';
INSERT INTO Buyer (PassportID) VALUES (21);
INSERT INTO Trace (Name) VALUES ("Kyiv-Lviv");
INSERT INTO Station (Name) VALUES ("Kyiv");
INSERT INTO Station (Name) VALUES ("Lviv");
INSERT INTO Train (TrainNumber, TraceID) VALUES (8, 1);
INSERT INTO Vagon (VagonNumber, VagonType, TrainID) VALUES (3, "Passenger", 1);
INSERT INTO Seat (SeatNumber, VagonID) VALUES (13, 1);
INSERT INTO Stop (StartTime, FinishTime, NumberInTrace, StationID, TraceID) VALUES ('2022-10-02 13:00:00', '2022-10-02 13:15:00', 1, 1, 1);
INSERT INTO Stop (StartTime, FinishTime, NumberInTrace, StationID, TraceID) VALUES ('2022-10-03 09:00:00', '2022-10-03 09:15:00', 2, 2, 1);
SELECT * FROM Buyer;
SELECT * FROM Trace;
SELECT * FROM Station;
SELECT * FROM Train;
SELECT * FROM Vagon;
SELECT * FROM Seat;
SELECT * FROM Stop;
INSERT INTO Ticket (Price, BuyerID, SeatID, FirstStopID, LastStopID) VALUES (234.12, 3, 1, 1, 2);
SELECT * FROM Ticket;